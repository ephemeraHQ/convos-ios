#!/usr/bin/env bash

# post-checkout
#
# https://git-scm.com/docs/githooks#_post_checkout

git_root="$(git rev-parse --show-toplevel)"

# if this is a file checkout then do nothing
if [ "${3}" == "0" ]; then exit; fi

# if same commit before and after checkout then do nothing
if [ "${1}" == "${2}" ]; then exit; fi

# Git
cd "${git_root}" && git submodule update --init --recursive

# Install gems via bundler
bundle install

# ensure secrets file exists (minimal version)
./Scripts/generate-secrets-local.sh --ensure-only

# generate secrets from .env file if available
if [ -f ".env" ]; then
    ./Scripts/generate-secrets.sh
fi
